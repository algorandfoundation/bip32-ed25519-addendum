\title{Bip32-Ed25519++: A More Secure Hierarchical Deterministic Wallet Standard for Ed25519 Keys}

\author{Chris Peikert\cite{Author1}, Yared Efrem Afework\cite{Author2}, Bruno Martins\cite{Author3}}

\newcommand{\abstractText}{\noindent

}

%%%%%%%%%%%%%%%%%
% Configuration %
%%%%%%%%%%%%%%%%%

\documentclass[12pt, a4paper, twocolumn]{article}
\usepackage{xurl}
\usepackage[super,comma,sort&compress]{natbib}
\usepackage{abstract}
\renewcommand{\abstractnamefont}{\normalfont\bfseries}
\renewcommand{\abstracttextfont}{\normalfont\small\itshape}
\usepackage{amsmath} % Add this line to define the \text command
\usepackage{titlesec}
\usepackage[skip=10pt]{parskip}

\titleformat*{\section}{\large\bfseries}
\titleformat*{\subsection}{\normalsize\bfseries}

% Any configuration that should be done before the end of the preamble:
\usepackage{hyperref}
\hypersetup{colorlinks=true, urlcolor=blue, linkcolor=blue, citecolor=blue}

\begin{document}

%%%%%%%%%%%%
% Abstract %
%%%%%%%%%%%%

\twocolumn[
  \begin{@twocolumnfalse}
    \maketitle
    \begin{abstract}
      \abstractText
      Implementing BIP32-style HD wallets for Ed25519 keys is a non-trivial task due to the non-linear key space of Ed25519. The paper BIP32-Ed25519 Hierarchical Deterministic Keys over a Non-linear Keyspace has seen wide adoption in the industry, but has some security issues. In this paper modifications are proposed that addresses those issues, at the cost of reducing the number of levels of child keys.
      \newline
      \newline
    \end{abstract}
  \end{@twocolumnfalse}
]

%%%%%%%%%%%
% Article %
%%%%%%%%%%%


\section{Introduction}

Blockchains rely on users to generate seed phrases that correspond to public/private keypairs for use in signing transactions on-behalf of an address. In the basic case, a single seed phrase corresponds to a single address, requiring users to keep track of many seed phrases should they wish to use separate addresses for separate domains of applications: making and receiving payments, holding NFTs, engaging in a DAO, DeFi, gaming, etc.


\subsection{Hierarchical Deterministic Wallets}


Bitcoin Improvement Proposal 32 (BIP32) was introduced to provide users with a means to deterministically derive many public/private keypairs from a single secret seed, greatly easing the management of seed phrases.

BIP43 introduced the concept of a purpose field, claiming that the original BIP32 standard allowed for too many degrees of freedom and resulted in many wallet softwares which claimed to be BIP32 compatible but were ultimately incompatible with each other. BIP44 took this a step further and defined 5 levels levels in the BIP32 path:

$m / \text{purpose}' / \text{coin\_type}' / \text{account}' / \text{change} / \text{key\_index}$

The apostrophe indicates that the field is hardened, meaning that the child key is derived in a way that prevents the parent public key from being derived from the child public key, or the sibling keys of that child key.

This class of wallets are known as Hierarchical Determinstic Wallets, or HD Wallets for short.

Other derivation schemes exist as well, such as BIP49 for P2SH nested SegWit addresses, and BIP84 for native SegWit addresses.

A complementary set of documents called SatoshiLab Improvement Protocols (SLIP) also exist, maintained by SatoshiLab (the creators of the Trezor hardware wallet) and come up in the context of BIP32 wallets. E.g. SLIP10 or SLIP23. SLIP44 extended BIP44 to assign coin type values for blockchains other than Bitcoin mainnet and testnet, e.g. $\text{283}'$ for Algorand.

\subsection{Elliptic curves and their key spaces}

Bitcoin relies on the Secp256k1 elliptic curve, which has a linear key space. A new public key can be formed by adding $[x]B$ to the public key $[k]B$, where $x$ and $k$ are private keys/scalars and $B$ the base point. This results in a new public key whose private key is $[x] + [k] mod q$ for $q$ the order of the field.

An alternate elliptic curve standard for digital signatures is Ed25519. It is used by a number of blockchains such as Algorand, Cardano, Nano, Monero and more. Polkadot uses a variant called Schnorrkel/Ristretto x25519 ("sr25519") and Trezor offers it alongside other curves.

Ed25519 has a number of advantages, such as high speed constant-time implementations and a signing procedure where the nonce is deterministically derived from the data to be signed (mitigating the kind of attack that Sony PS3 suffered).

Unfortunately, private keys have to be derived by hashing the seed and manipulating the bits. Of the 32 byte private key:

\begin{itemize}
  \item Bits 0, 1, 2:  set to 0, ensuring that the key is a multiple of 8 and avoiding small subgroup attacks.
  \item Bit 254: set to 1, to ensuring the Montgommery ladder computation used in scalar multiplication runs in constant time.
  \item Bit 255: set to 0, ensuring the key is in the range of the field order ($2^{255} - 19$).
\end{itemize}

As a result, the key space for Ed25519 is non-linear.

A paper that has seen adoption in the industry is BIP32-Ed25519
Hierarchical Deterministic Keys over a Non-linear Keyspace \cite{BIP32-Ed25519}. It extends the BIP32 standard to work with Ed25519 keys. It has been adopted by Cardano, though conforming additionally with SLIP10 to derive the initial master Ed25519 key and chain code.

While solving the problem (with only minor modifications to BIP32 and working with "after-hash" private keys of Ed25519), in this paper an improvement to their method is proposed that provides a more secure way to derive Ed25519 keys, at the cost of reducing the number of levels of child keys.


\section{Security Review}

The BIP32-Ed25519 by  proposal provides similar features for Ed25519 keys [, which are widely used in <projects>]. However, in the current draft, derived private keys are somewhat closely related, in ways that can significantly degrade security. For example, if even a single "child" private key is compromised, then the security of its "parent" key degrades to only 112--114 bits. In other words, computing the parent key may become more than 64,000 times easier for the attacker. If many sibling private keys are compromised, the parent key's security is degraded even further. And the same applies to further ancestors, up to the root private key.


\section{Suggestions for Improvements}

The purpose of our modifications is to make derived keys less related, so that there is less security degradation if some private keys are compromised. While the BIP32 approach cannot produce completely unrelated Ed25519 keys, our modifications ensure a reduction of only about 3 bits [DEPENDS ON WHICH "g" VALUE YOU CHOSE; IT'S (g-4)/2 BITS] of security in the above scenario. This is done without sacrificing the number of child keys a parent can have, and by retaining a deep enough hierarchy of keys for applications.

\section{Implementations}

The suggestions provided in this paper have been implemented as part of the ARC52 Bip32-Ed25519 libraries provided by the Algorand Foundation.

\begin{itemize}
  \item \href{https://github.com/algorandfoundation/bip32-ed25519-kotlin}{Kotlin}
  \item \href{https://github.com/algorandfoundation/bip32-ed25519-swift}{Swift}
  \item \href{https://github.com/algorandfoundation/bip32-ed25519-ts}{TypeScript}
\end{itemize}


\section{Conclusion}

In this paper we have proposed a modification to the BIP32-Ed25519 standard that provides a more secure way to derive Ed25519 keys, at the cost of reducing the number of levels of child keys. We have shown that this modification provides a significant improvement in security, while still providing a sufficient number of child keys for most applications.

%%%%%%%%%%%%%%
% References %
%%%%%%%%%%%%%%

\nocite{*}
\bibliographystyle{plain}
\bibliography{sources}

\end{document}